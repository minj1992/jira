$token = "dummytoken"  # Replace with your actual token
$baseUrl = "https://dev-domain.com"  # Replace with your Jira domain
$triggerReindexUrl = "$baseUrl/proxy/rest/api/2/reindex/progress?type=FOREGROUND"

try {
    # Ensure there are no leading or trailing spaces in the token
    $token = $token.Trim()

    # Send the POST request using Invoke-WebRequest to capture both headers and body
    $response = Invoke-WebRequest -Uri $triggerReindexUrl `
                                  -Headers @{ 
                                      "Authorization" = "Bearer $token"; 
                                      "Accept" = "application/json" 
                                  } `
                                  -Method POST `
                                  -ErrorAction Stop

    # Output the response headers
    Write-Output "Response Headers: $($response.Headers | ConvertTo-Json -Depth 2)"
    
    # Output the full response (body)
    Write-Output "Response Body: $($response.Content | ConvertTo-Json -Depth 2)"
    
    # Parse the JSON body
    $body = $response.Content | ConvertFrom-Json
    
    if ($body.status -eq 'STARTED') {
        Write-Output "Reindexing has started successfully."
    } else {
        Write-Output "Unexpected response: $($body.status)"
    }
} catch {
    Write-Error "Error occurred: $_"
}
